<%- include("partials/header.ejs") %>

<link rel="stylesheet" href="/styles/green-toast.css">

<!-- toast hidden by default until triggered -->
<div id="toast" class="toast" style="display: none;">
    <span class="icon">✅</span>
    <span class="message">Removed From Cart</span>
    <span class="close" onclick="closeToast()">&times;</span>
    <div class="progress"></div>
  </div>

  <% if (!cart || cart.items.length === 0) { %>
    <div class="empty-cart-message">
      <p>Your cart is empty. You have no items currently in your cart.</p>
      <a href="/">← Continue shopping</a>
    </div>
  <% } else { %>
    <% cart.items.forEach(item => { %>
      <div class="cart-product-container">
        <img src="/images/<%= item.foodId._id %>" alt="<%= item.foodId.title %>">
    
        <div class="cart-prod">
            <div class="prod-title">
                <div>Title:</div>
                <div><%= item.foodId.title %></div>
            </div>
    
            <div class="prod-price">
                <div>Price:</div>
                <div>$<%= item.price %></div>
            </div>
    
            <div class="prod-quantity">
                <div>Quantity:</div>
                <div><%= item.quantity %></div>
            </div>
    
            <div class="prod-total">
                <div>Total:</div>
                <div>$<%= item.total %></div>
            </div>
    
            <div class="remove-prod">
              <div>Remove:</div>
              <form action="/cart/delete/<%= item.foodId._id %>?_method=DELETE" method="POST">
                  <input type="submit" value="x">
              </form>
            </div>
        </div>
      </div>
      <hr>
    <% }) %>
  
    <div class="cart-totals">
      <div>Cart Totals</div>
  
      <div class="prod-subtotal">
          <div>Subtotal</div>
          <div>$<%= subtotal %></div>
      </div>
      <hr>
      <div class="prod-delivery-fee">
          <div>Delivery Fee</div>
          <div>$3</div>
      </div>
      <hr>
      <div class="cart-total">
          <div>Total</div>
          <div>$<%= subtotal + 3 %></div>
      </div>
  
      <a href="/order">
          <button type="submit">PROCEED TO CHECKOUT</button>
      </a>
    </div>
  <% } %>
  

<script>
    const params = new URLSearchParams(window.location.search);
  
    if (params.has('productDeleted')) {
        showToast("Removed From Cart");
    }
  
    function showToast(message) {
        const toast = document.getElementById("toast");
        toast.querySelector(".message").textContent = message;
        toast.style.display = "flex";
  
        const progress = toast.querySelector(".progress");
        progress.style.animation = "none";
        void progress.offsetWidth; // Restart animation
        progress.style.animation = "progressBar 3s linear forwards";
  
        setTimeout(() => {
        toast.style.display = "none";
        }, 3000);
    }
  
    function closeToast() {
        document.getElementById("toast").style.display = "none";
    }  
  </script>

<script src="/javascripts/drop_down_menu.js"></script>

</body>

</html>